<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Yao's Blog</title>
  <meta name="description" content="Yao's blog on everything about web technologies'">

  <link rel="stylesheet" href="/public/css/main.css">
  <link rel="canonical" href="https://yaodingyd.github.io/">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/black/pace-theme-flash.min.css" />
  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yaodingyd.github.io">
  <meta property="og:title" content="Yao's Blog">
  <meta property="og:image" content="">
  <meta property="og:description" content="Yao's blog on everything about web technologies">
  <meta property="og:site_name" content="Yao's Blog">
  <meta property="og:locale" content="en_US">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@YaoDingSD">
  <meta name="twitter:url" content="https://yaodingyd.github.io">
  <meta name="twitter:title" content="Yao's Blog">
  <meta name="twitter:description" content="Yao's blog on everything about web technologies">
  <meta name="twitter:image" content="https://example.com/image.jpg">


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86352654-1', 'auto');
  ga('send', 'pageview');
  </script>
</head>

  <body class="site">

        <header class="header" role="banner">
    <a class="header__avatar" href="/">
        <img class="header__avatar-img" src="/resource/avatar.jpg">
    </a>
    <nav class="header__nav">
        <a class="header__nav-link" href="/">Blog</a>
        <a class="header__nav-link" href="/project/">Project</a>
        <a class="header__nav-link" href="/about/">About</a>
    </nav>
</header>

        <main id="barba-wrapper" class="site__content" aria-label="Content">
          <div class="barba-container">
          <div class="container">
  <article class="post" itemtype="http://schema.org/BlogPosting">  
    <header class="post__header">
      <h1 class="title" itemprop="name headline">Key Takeaways About Event Loop, Tasks and Microtasks</h1>
      <div class="post__meta">
        <time class="post__time">Feb 18, 2018</time>
          
          
            <a href="/tag#web-fundamental" class="post__tag">Web Fundamental</a>
          
        
      </div>
    </header>

    <div class="post__content" itemprop="articleBody">
      <p>Key points on event loop, tasks and microtasks:</p>

<ol>
  <li>Browser has one  main thread of JavaScript runtime, and several other threads running in background (web worker). JavaScript runtime is single-threaded.</li>
  <li>Each thread gets its own event loop, and executes independently, whereas all windows on the same origin share an event loop as they can synchronously communicate.</li>
  <li>The event loop runs continually, executing any tasks queued. Tasks are usually generated by Web APIs.</li>
  <li>Example of tasks: <code class="highlighter-rouge">setTimeout</code>, <code class="highlighter-rouge">setInternal</code>, <code class="highlighter-rouge">setImmediate</code>, <code class="highlighter-rouge">message channel</code> and I/O tasks (DOM event and HTTP request).</li>
  <li>Example of microtasks: <code class="highlighter-rouge">promise</code> and <code class="highlighter-rouge">mutation observer</code>.</li>
  <li>Browser render steps are (JavaScript -&gt;) style calculation -&gt; layout -&gt; paint. Browser could run render between tasks. Usually tasks finishes first then browser runs render, but certain properties or methods will trigger the browser to synchronously calculate the style and layout (<a href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a">this gist</a>), which causes performance issue.</li>
  <li><code class="highlighter-rouge">requestAnimationFrame</code> is within the render steps (rAF -&gt; S -&gt; L -&gt; P). It is not a task. It is always before style calculation. (Safari currently puts rAF as the last step of render, which is a bug. Chrome and Firefox are doing fine.)</li>
  <li>Render always executes at the beginning of each frame. Task can happen anytime during one frame.</li>
  <li>Microtasks execute in order, and are executed: after every callback, as long as no other JavaScript is mid-execution, or at the end of each task.</li>
  <li>In one loop, only one task can be processed. In one frame, animation callback queues executes to completion, but except the ones queued in this frame, which are deferred to the next frame. When microtasks are processed, microtask queue is processed to completion including any additional mircotask queued within this time.</li>
  <li>Event triggering and bubbling is asynchronous, as all I/O tasks. Microtasks can happen in between the same event bubbling to its parent. But pay attention to JavaScript emulating event, as it can be synchronous.</li>
</ol>

<h4 id="references">References:</h4>
<ol>
  <li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0">Jake Archibald: In The Loop</a></li>
  <li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">Tasks, microtasks, queues and schedules</a></li>
</ol>

    </div>
  </article>

  <div class="page-navigation">
    
      <a class="page__prev" href="/blog/from-jasmine-ajax-to-jquery-ajax/">&laquo; From Jasmine-ajax to jQuery Ajax</a>
    
    
  </div>
</div>

          </div>
        </main>

        <footer class="footer" id="barba-footer">
  <div class="footer__title">Yao Ding</div>
  <div class="footer__links">
      <a class="footer__link" href="mailto:yaodingyd@gmail.com">Email</a>
      <a  class="footer__link" href="https://github.com/yaodingyd">Github</a>
  </div>
</footer>

<!-- <script src="/public/js/src.js"></script> -->


  </body>
</html>
