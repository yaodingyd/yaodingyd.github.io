<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Yao's Blog</title>
  <meta name="description" content="Yao's blog on everything about web technologies'">

  <link rel="stylesheet" href="/public/css/main.css">
  <link rel="canonical" href="https://yaodingyd.github.io/">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/black/pace-theme-flash.min.css" />
  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yaodingyd.github.io">
  <meta property="og:title" content="Yao's Blog">
  <meta property="og:image" content="">
  <meta property="og:description" content="Yao's blog on everything about web technologies">
  <meta property="og:site_name" content="Yao's Blog">
  <meta property="og:locale" content="en_US">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@YaoDingSD">
  <meta name="twitter:url" content="https://yaodingyd.github.io">
  <meta name="twitter:title" content="Yao's Blog">
  <meta name="twitter:description" content="Yao's blog on everything about web technologies">
  <meta name="twitter:image" content="https://example.com/image.jpg">


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86352654-1', 'auto');
  ga('send', 'pageview');

</script>
  
</head>

  <body>

        <header class="site-header" role="banner">
    <div class="wrapper">
        <a class="site-title" href="/">Yao Ding</a>
        <nav class="site-nav" id="nav">
            <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </a>
            <span class="trigger">
                <a class="page-link" href="/project/">Project</a>
            </span>
            <span class="trigger">
                <a class="page-link" href="/note/">Note</a>
            </span>
            <span class="trigger">
                <a class="page-link" href="/about/">About</a>
            </span>
        </nav>
  </div>
</header>

        <main id="barba-wrapper" class="page-content" aria-label="Content">
          <div class="wrapper barba-container">
          <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Prototype Is Driving Me Crazy</h1>
    <p class="post-meta"><time datetime="2016-04-08T00:00:00-04:00" itemprop="datePublished">Sep 7, 2016</time></p>
      
      
        <a href="/tag#javascript" class="post-tag">JavaScript</a>
      
        <a href="/tag#programming" class="post-tag">Programming</a>
      
    


  </header>

  <div class="post-content" itemprop="articleBody">
    <p>JavaScript is a not a strictly OOP language, and it is driving me crazy.</p>

<h3 id="prototype-property-vs-prototype">‘Prototype’ property vs [[Prototype]]</h3>
<p>JavaScript objects all have ‘prototype’, but it is considered as a “internal property”, denoted by double brackets(<code class="highlighter-rouge">[[Prototype]]</code>), which links back to <code class="highlighter-rouge">Object.prototype</code>. A function, which is a object too, has the ‘visible’ prototype property. This is why the following code runs like this in Chrome:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="c1">//x's [[Prototype]] would be undefined because it's 'hidden'</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="c1">// __proto__ would be Object.prototype </span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
    <span class="c1">//y's Prototype would be Object, with a constructor function and __proto__</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">x1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">y</span><span class="p">();</span>
    <span class="c1">// now __proto__ would be y, and prototype still be undefined</span>
</code></pre>
</div>

<p>In Chrome, <code class="highlighter-rouge">__proto__</code> would be the non-standard accessible internal property of <code class="highlighter-rouge">[[Prototype]]</code>.</p>

<p>In ES6 there is a new function <code class="highlighter-rouge">Object.setPrototypeOf</code> sets the prototype ( internal <code class="highlighter-rouge">[[Prototype]]</code>) of a specified object to another object or null. On MDN it warning about the slow operated yet subtle and far-flung effect. In Babel, polyfill for <code class="highlighter-rouge">class</code> there is one line of code:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">superClass</span><span class="p">)</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span> <span class="p">?</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span><span class="p">(</span><span class="nx">subClass</span><span class="p">,</span> <span class="nx">superClass</span><span class="p">)</span> <span class="p">:</span> <span class="nx">subClass</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">superClass</span>
</code></pre>
</div>

<p>Basically it sets subClass’s <code class="highlighter-rouge">__proto__</code> point to superClass.</p>

<h3 id="chicken-and-egg">Chicken and egg</h3>

<p>Here is one interesting part about <code class="highlighter-rouge">Function</code> and <code class="highlighter-rouge">Object</code>’s prototype. We know that <code class="highlighter-rouge">Object.prototype</code> would be at the top of all prototype chain, so</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="kc">null</span> <span class="c1">// true</span>
</code></pre>
</div>
<p>And you can use <code class="highlighter-rouge">new Object()</code>, so Object is also a function, and Function is an object, thus</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nb">Object</span> <span class="k">instanceof</span> <span class="nb">Function</span> <span class="c1">// true</span>
<span class="nb">Function</span> <span class="k">instanceof</span> <span class="nb">Object</span> <span class="c1">// true</span>
</code></pre>
</div>
<p>But</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">===</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">__proto__</span> <span class="c1">// true</span>
<span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span> <span class="c1">// true</span>
</code></pre>
</div>
<p>This is becauof of EMCA’s specs:</p>
<blockquote>
  <p>Every built-in function and every built-in constructor has the Function prototype object, which is the initial value of the expression Function.prototype (15.3.4), as the value of its [[Prototype]] internal property.</p>
</blockquote>

<blockquote>
  <p>Unless otherwise specified every built-in prototype object has the Object prototype object, which is the initial value of the expression Object.prototype (15.2.4), as the value of its [[Prototype]] internal property, except the Object prototype object itself.</p>
</blockquote>

<blockquote>
  <p>The Function prototype object is itself a Function object (its [[Class]] is “Function”) that, when invoked, accepts any arguments and returns undefined.</p>
</blockquote>

<blockquote>
  <p>The value of the [[Prototype]] internal property of the Function prototype object is the standard built-in Object prototype object (15.2.4). The initial value of the [[Extensible]] internal property of the Function prototype object is true.</p>
</blockquote>

<blockquote>
  <p>The Function prototype object does not have a valueOf property of its own; however, it inherits the valueOf property from the Object prototype Object.</p>
</blockquote>

<h3 id="constructor">Constructor</h3>
<p>A constructor is a just another function used for initializing new objects, and you use the <code class="highlighter-rouge">new</code> keyword to call the constructor. So technically speaking, there is no “constructor function”, there is only “constructor call”. Prototype property would also has a constructor property(Object.prototype.constructor). So for a constructor function  <code class="highlighter-rouge">object_constructor</code>, <code class="highlighter-rouge">object_constructor.prototype.constructor</code> would be itself.</p>

<p>So When a new object_constructor() is called, JavaScript does four things:
1.It creates a new object.
2.It sets the constructor property of the object to object_constructor.(In ES6)
3.It sets up the object to <em>delegate</em> to object_constructor.prototype.
4.It calls object_constructor() in the context of the new object.</p>

<p>In this way, whatever property initialized in constructor would be new object’s own property; whatever property delegated from prototype would also become new object’s property, but not its <em>own</em>( with <code class="highlighter-rouge">Object.keys()</code>). This is also how prototype chain work: all property followed by the prototype chain would be the new object’s properties. Thus, when we do a <code class="highlighter-rouge">for...in...</code> to iterate properties in object, we use <code class="highlighter-rouge">hasOwnProperty</code> to make sure.</p>

<p>Currently in ES5, prototype.constructor is kind of a placeholder property to ensure that your newly created object is an instance of your parent. Note that the value of this property is a reference to the function itself, and it can be treated as ‘read-only’.  If you change your prototype.constructor,  and create a new child with new parent(), the child’s property stays the same, you can try it! Only if you deliberately use the constructor function, it will be used.</p>

<p>Contructor also introduce an issue, that is <code class="highlighter-rouge">instanceof</code>. <code class="highlighter-rouge">instanceof</code> checks type by checking ‘instance’’s [[Prototype]] is equal to ‘constructor’s prototype. Read this more on <a href="https://medium.com/javascript-scene/javascript-factory-functions-vs-constructor-functions-vs-classes-2f22ceddf33e#.av1qtyvf9">this article</a>.</p>

<h3 id="static-method-vs-prototype-method">Static method vs Prototype method</h3>
<p>In ES6, using the <code class="highlighter-rouge">class</code> syntax sugar could help you create a more OOP-like JavaScript object. And you can even use <code class="highlighter-rouge">static</code> to declare static method. The ones without <code class="highlighter-rouge">static</code> keyword are declared as prototype methods. It would be something like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">myClass</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">staticMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// normally it's a utility class, and we don't use `this` that much</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">myClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prototypeMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// `this` is used a lot because it's uauslly used on an instance</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The reason why we put instance method in prototype is that using “this” results in every instance of the class  having its own independent copy of method, whereas using prototype will mean that each instance of class  will use the same copy of method. Thus, declaring methods on the prototype is more memory efficient.</p>

<h3 id="create-a-subclass">Create a ‘subclass’</h3>
<p>Code first:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="kd">function</span> <span class="nx">Parent</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">someProp</span> <span class="o">=</span> <span class="err">“</span><span class="nx">some</span> <span class="nx">prop</span><span class="err">”</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">Child</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Parent</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// call super constructor.</span>
    <span class="p">}</span>
    <span class="c1">// Child.prototype.constructor is Child.</span>
    <span class="c1">// subclass extends superclass</span>
    <span class="nx">Child</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span> <span class="c1">//assign prototype, but overwrite Child.prototype.constructor to Parent</span>
    <span class="nx">Child</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Child</span><span class="p">;</span> <span class="c1">// restore constructor to Child</span>

    <span class="c1">// or this, I learned this from Babel's polyfill for class</span>
    <span class="nx">Child</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Parent</span> <span class="o">&amp;&amp;</span> <span class="nx">Parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">constructor</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">Child</span><span class="p">,</span>
            <span class="na">enumerable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">writable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">configurable</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre>
</div>

<p>We use <code class="highlighter-rouge">Object.create</code> instead of <code class="highlighter-rouge">new Super()</code> to assign <code class="highlighter-rouge">Child.prototype</code> because it complicates all of your constructor functions, limits their ability to detect construction errors, and requires that all constructors everywhere handle that form of use. And this is call Parasitic Combination Inheritance pattern.</p>

<p>Here is a simple polyfill of Object.create:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="kd">function</span> <span class="nx">createObject</span><span class="p">(</span><span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">function</span> <span class="nx">ctor</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
        <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre>
</div>
<p>This is called also ‘Parasitic Combination Inheritance’.</p>

<h3 id="inheritance-vs-delegation">Inheritance vs Delegation</h3>

<p>“Inheritance” always implies a copy operation. This is what happens in Java, so if you extend a children class from parent class, all parent’s property will be copied to children class. But JavaScript doesn’t copy object properties (natively, by default). Instead, JS creates a link between two objects, where one object can essentially delegate property/function access to another object. So we should call “Prototype Delegation”. In ES6 though it uses <code class="highlighter-rouge">extend</code> to make it look like a ‘copy’, deep down it still is a delegation.</p>

<h3 id="read-more">Read more</h3>

<p>This article is somewhat my cheatsheet to Prototype. Read the famous <a href="https://github.com/getify/You-Dont-Know-JS/tree/master/this%20%26%20object%20prototypes">You Dont Know JS</a> for a more thorough and deep understanding for Prototype.</p>


  </div>

  
</article>

<div class="page-navigation">
  
    <a class="prev" href="/blog/factory-pattern/">&laquo; Factory Pattern</a>
  
  
    <a class="next" href="/blog/scrollbar-and-window-width/">Scrollbar And Window Width &raquo;</a>
  
</div>

<div id="disqus_thread"></div>
<script>
  // var disqus_developer = 1;
  var disqus_config = function () {
    this.page.url = "https://yaodingyd.github.io//blog/prototype-is-driving-me-crazy/";  
    this.page.identifier = "/blog/prototype-is-driving-me-crazy"; 
  };
  (function() { var d = document, s = d.createElement('script');s.src = 'https://yaoding.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());(d.head || d.body).appendChild(s);})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

          </div>
        </main>

        <footer class="site-footer">
  <div class="wrapper">
    <h2 class="footer-heading">Yao Ding</h2>
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:yaodingyd@gmail.com">yaodingyd@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://github.com/yaodingyd"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg></span><span class="username">yaodingyd</span></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.1/TweenMax.min.js"></script>
<script src="/public/script/main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.js"></script>

  </body>
</html>
